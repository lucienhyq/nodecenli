"use strict";(self["webpackChunkp"]=self["webpackChunkp"]||[]).push([[691],{4068:function(t,e,i){i.d(e,{A:function(){return f}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"quillEditor"},[e("el-upload",{staticStyle:{display:"none"},attrs:{action:"http://localhost:3000/posts","list-type":"picture-card","on-success":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[e("i",{staticClass:"el-icon-plus quilleditor_img"})]),e("div",[e("el-dialog",{staticStyle:{"margin-top":"1px"},attrs:{"close-on-click-modal":!1,width:"50%",title:"视频上传",visible:t.videoDialog.show,"append-to-body":""},on:{"update:visible":function(e){return t.$set(t.videoDialog,"show",e)}}},[e("el-tabs",{model:{value:t.videoDialog.activeName,callback:function(e){t.$set(t.videoDialog,"activeName",e)},expression:"videoDialog.activeName"}},[e("el-tab-pane",{attrs:{label:"添加视频链接",name:"first"}},[e("el-input",{attrs:{placeholder:"请输入视频链接",clearable:""},model:{value:t.videoDialog.videoLink,callback:function(e){t.$set(t.videoDialog,"videoLink",e)},expression:"videoDialog.videoLink"}}),e("el-button",{staticStyle:{margin:"20px 0px 0px 0px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.addVideoLink(t.videoDialog.videoLink)}}},[t._v("添加 ")])],1),e("el-tab-pane",{attrs:{label:"本地视频上传",name:"second"}},[e("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:t.uploading,expression:"uploading"}],staticStyle:{"text-align":"center"},attrs:{drag:"",action:t.uploadUrl,accept:"video/*",data:t.videoFileData,"before-upload":t.onBeforeUploadVideo,"on-success":t.onSuccessVideo,"on-error":t.onErrorVideo,multiple:!1}},[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v(" 将文件拖到此处，或"),e("em",[t._v("点击上传")])])])],1)],1)],1)],1),e("quill-editor",{ref:"myTextEditor",attrs:{options:t.editorOption},on:{change:t.onEditorChange},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)},a=[],s=i(5771);const l=s.Quill.import("blots/block/embed"),r=s.Quill.import("formats/link"),n=["height","width"];class d extends l{static create(t){const e=super.create(t);return e.setAttribute("controls","controls"),e.setAttribute("type","video/mp4"),e.setAttribute("src",this.sanitize(t)),e.setAttribute("preload","metadata"),e}static formats(t){return n.reduce(((e,i)=>(t.hasAttribute(i)&&(e[i]=t.getAttribute(i)),e)),{})}static sanitize(t){return r.sanitize(t)}static value(t){return t.getAttribute("src")}format(t,e){n.indexOf(t)>-1?e?this.domNode.setAttribute(t,e):this.domNode.removeAttribute(t):super.format(t,e)}html(){const{video:t}=this.value();return`<a href="${t}">${t}</a>`}}d.blotName="video",d.className="ql-video",d.tagName="video";var c=d;class u{constructor(t,e={}){this.quill=t,this.handleDrop=this.handleDrop.bind(this),this.handlePaste=this.handlePaste.bind(this),this.quill.root.addEventListener("drop",this.handleDrop,!1),this.quill.root.addEventListener("paste",this.handlePaste,!1)}handleDrop(t){if(t.preventDefault(),t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length){if(document.caretRangeFromPoint){const e=document.getSelection(),i=document.caretRangeFromPoint(t.clientX,t.clientY);e&&i&&e.setBaseAndExtent(i.startContainer,i.startOffset,i.startContainer,i.startOffset)}this.readFiles(t.dataTransfer.files,this.insert.bind(this))}}handlePaste(t){t.clipboardData&&t.clipboardData.items&&t.clipboardData.items.length&&this.readFiles(t.clipboardData.items,(t=>{const e=this.quill.getSelection();e||setTimeout((()=>this.insert(t)),0)}))}insert(t){const e=(this.quill.getSelection()||{}).index||this.quill.getLength();this.quill.insertEmbed(e,"image",t,"user")}readFiles(t,e){[].forEach.call(t,(t=>{if(!t.type.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp|vnd\.microsoft\.icon)/i))return;const i=new FileReader;i.onload=t=>{e(t.target.result)};const o=t.getAsFile?t.getAsFile():t;o instanceof Blob&&i.readAsDataURL(o)}))}}s.Quill.register(c,!0),s.Quill.register("modules/imageDrop",u);var m={components:{quillEditor:s.quillEditor},data(){return{content:"",editorOption:null,videoDialog:{show:!1,activeName:"",videoLink:""},uploading:"",uploadUrl:"",videoFileData:{}}},methods:{onEditorChange({editor:t,html:e,text:i}){this.$emit("quillBlur",e)},handlePictureCardPreview(t){let e=this.$refs.myTextEditor.quill,i=e.getSelection().index;console.log(t),e.insertEmbed(i,"image",t.data),e.setSelection(i+1)},handleRemove(){},onBeforeUploadVideo(){},onSuccessVideo(){},onErrorVideo(){},addVideoLink(t){if(console.log(t),!t)return this.$message.error("请输入视频地址");this.videoDialog.show=!1;let e=this.$refs.myTextEditor.quill.savedRange,i=0;null!=e&&(i=e.index),this.$refs.myTextEditor.quill.insertEmbed(i,"video",t),this.$refs.myTextEditor.quill.setSelection(i+1)}},created(){const t=[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["image","video"]];this.editorOption={theme:"snow",placeholder:"请输入正文",modules:{imageDrop:!0,toolbar:{container:t,handlers:{image:function(t){t?document.querySelector(".quilleditor_img").click():this.quill.format("image",!1)},video:t=>{this.videoDialog.show=!0}}}}}}},h=m,p=i(845),g=(0,p.A)(h,o,a,!1,null,"090e30e2",null),f=g.exports},9691:function(t,e,i){i.r(e),i.d(e,{default:function(){return c}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"goodsEdit"},[e("div",{staticClass:"bgbox"},[e("div",{staticClass:"topHead"},[e("div",{staticClass:"title_l",on:{click:t.toBlack}},[e("i",{staticClass:"el-icon-arrow-left"}),t._v(" 返回列表 ")]),e("div",{staticClass:"title"},[t._v("添加商品")])]),e("div",{staticClass:"formBox"},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"120px","label-position":"left"}},[e("el-form-item",{attrs:{label:"商品标题"}},[e("el-input",{staticStyle:{width:"300px"},attrs:{disabled:t.tag,placeholder:"请输入商品标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:"商品价格"}},[e("el-input",{staticStyle:{width:"300px"},attrs:{disabled:t.tag,placeholder:"请输入商品价格"},model:{value:t.form.course_price,callback:function(e){t.$set(t.form,"course_price",e)},expression:"form.course_price"}})],1),e("el-form-item",{attrs:{label:"商品是否上架"}},[e("el-switch",{attrs:{disabled:t.tag},model:{value:t.form.shelfStatus,callback:function(e){t.$set(t.form,"shelfStatus",e)},expression:"form.shelfStatus"}}),e("span",{staticClass:"shelfStatusTxt"},[t._v(t._s(t.form.shelfStatus?"上架":"下架"))])],1),e("el-form-item",{attrs:{label:"商品图片"}},[e("div",{staticClass:"flex"},[t.form.goodimg&&this.$route.params.id?e("img",{staticStyle:{width:"150px",height:"150px"},attrs:{src:t.form.goodimg,alt:""}}):t._e(),t.tag?t._e():e("el-upload",{attrs:{"show-file-list":!1,action:"http://localhost:3000/posts","list-type":"picture-card","on-success":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[e("i",{staticClass:"el-icon-plus"})])],1)]),e("el-form-item",{attrs:{label:"商品类型"}},[e("el-radio-group",{model:{value:t.form.goodStatus,callback:function(e){t.$set(t.form,"goodStatus",e)},expression:"form.goodStatus"}},[e("el-radio",{attrs:{label:"1",disabled:t.tag}},[t._v("普通商品")]),e("el-radio",{attrs:{label:"2",disabled:t.tag}},[t._v("预约商品")])],1)],1),e("el-form-item",{attrs:{label:"商品库存"}},[e("el-input",{staticStyle:{width:"300px"},attrs:{disabled:t.tag,placeholder:"请输入商品库存"},model:{value:t.form.inventory,callback:function(e){t.$set(t.form,"inventory",e)},expression:"form.inventory"}})],1),e("el-form-item",{attrs:{label:"商品详情"}},[e("quillEditor",{attrs:{contenInfo:t.form.conten,disabled:t.tag},on:{quillBlur:t.quillBlur}})],1)],1)],1),"look"!=this.$route.query.tag?e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(this.$route.params.id?"编辑商品":"发布商品"))]):t._e()],1)])},a=[],s=(i(4114),i(4068)),l={data(){return{form:{title:"",course_price:"",conten:"",shelfStatus:!1,goodimg:"",inventory:"",goodStatus:"2",creatUser:1},dialogVisible:!1,tag:!1}},components:{quillEditor:s.A},activated(){this.$route.params.id&&this.getData(),this.$route.query&&(this.tag="look"==this.$route.query.tag),console.log(this.$route.query)},methods:{getData(){$http.post("courseList",{id:this.$route.params.id},"获取中").then((t=>{console.log(t.data);let e=t.data.list[0];this.form.title=e.title,this.form.course_price=Number(e.course_price),this.form.conten=e.conten,this.form.shelfStatus=e.shelfStatus,this.form.goodimg=e.goodimg,this.form.inventory=e.inventory,this.form.goodStatus=e.goodStatus})).catch((t=>{console.log(t)}))},quillBlur(t){console.log(t),this.form.conten=t,console.log(this.form)},handlePictureCardPreview(t){this.form.goodimg=t.data,console.log(this.form.goodimg,"goodimg")},toBlack(){this.$router.push({name:"goods"})},onSubmit(){if(this.tag)return void this.$message.success("查看商品不可编辑");let t={form:this.form};this.$route.params.id&&(t.id=this.$route.params.id),$http.post(this.$route.params.id?"courseList_updateOne":"courseIndex",t,"获取中").then((t=>{this.visitorData=t.data,this.$message.success("成功"),this.$router.replace({name:"goods"})})).catch((t=>{console.log(t)}))},handleRemove(t){console.log(t)}}},r=l,n=i(845),d=(0,n.A)(r,o,a,!1,null,"341287b1",null),c=d.exports}}]);
//# sourceMappingURL=691.733e40e4.js.map